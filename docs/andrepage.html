<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rack: Anomaly Detection and Removal (AnDRe)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="rack.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rack-logo-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><!-- rack /-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Anomaly Detection and Removal (AnDRe) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#andreintro">Introduction</a><ul><li class="level2"><a href="#anomalies">Background</a></li>
<li class="level2"><a href="#andrecommands">AnDRe commands</a></li>
</ul>
</li>
<li class="level1"><a href="#detectors">Detection</a><ul><li class="level2"><a href="#aBiomet">Detecting birds and insects (single-pol)</a></li>
<li class="level2"><a href="#aBiomet2">Detecting birds and insects (dual-pol)</a></li>
<li class="level2"><a href="#aClutter">Detecting ground clutter</a></li>
<li class="level2"><a href="#aDopplerNoise">Detecting variations in Doppler wind</a></li>
<li class="level2"><a href="#aEmitter">Detecting emitters (electromagnetic interference)</a></li>
<li class="level2"><a href="#aJamming">Detecting jamming</a></li>
<li class="level2"><a href="#aNonMet">Detecting sea clutter and other non-meteorogical targets</a></li>
<li class="level2"><a href="#aShip">Detecting ships</a></li>
<li class="level2"><a href="#aSpeckle">Detecting speckle noise</a></li>
<li class="level2"><a href="#aSun">Detecting the Sun</a></li>
</ul>
</li>
<li class="level1"><a href="#andreCumulation">Cumulating quality fields</a></li>
<li class="level1"><a href="#andreremoval">Anomaly removal</a></li>
<li class="level1"><a href="#otherQuality">Other quality fields</a><ul><li class="level2"><a href="#aAttenuation">Attenuation in rain</a></li>
<li class="level2"><a href="#aCCor">Using Doppler filtering result</a></li>
<li class="level2"><a href="#aTime">Timing based quality</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><em></em></p>
<h1><a class="anchor" id="andreintro"></a>
Introduction</h1>
<p>This section explains <b>AnDRe</b>, the set of anomaly detection and removal functions of <b>Rack</b>. A quick reference of all the commands is found in <a class="el" href="quickpage.html#commands_andre">Anomaly detection and removal</a>.</p>
<h2><a class="anchor" id="anomalies"></a>
Background</h2>
<p>Practically, echoes received by a weather radar originate not only from precipitating clouds but also from insects, birds, aircraft, ships, ground, sea clutter and electromagnetic emitters illustrated in the figure below.</p>
<div class="image">
<img src="radar-anomalies-compact2.png" alt=""/>
<div class="caption">
Sources of anomalies.</div></div>
 <p>These external factors &ndash; or anomalies from the meteorological point of view &ndash; affect radar data in various ways. Some of the anomalies appear as distinct, localized peaks, some form geometrical patterns and some affect the overall data. Examples of effects are shown in the image set below.</p>
<div class="image">
<img src="volumes-anom-panel.png" alt="" width="90%"/>
<div class="caption">
Samples containing several types of anomaly.</div></div>
 <h2><a class="anchor" id="andrecommands"></a>
AnDRe commands</h2>
<p>In AnDRe, the processing is divided into two stages: <b>detecting</b> anomalies and <b>removing</b> the anomalies from input data. In principle, these stages modify ODIM data independently so a user may combine <b>Rack</b> with other software performing anomaly detection (see <a class="el" href="fileiopage.html#file_quality">Reading and combining quality data</a>). The independence also means that anomalies can be detected using parallel computation in future versions of <b>Rack</b> (see <a class="el" href="parallelpage.html#parallel_anom">Anomaly detection</a>).</p>
<p>The following code is an example of applying both detection and removal in <b>Rack</b> :</p>
<div class="fragment"><div class="line">rack volume.h5 --select &#39;elangle=0.3:1.5&#39; \</div>
<div class="line">  --aEmitter &#39;5,5,0.5&#39; \</div>
<div class="line">  --aJamming &#39;5,80,10,-1&#39; \</div>
<div class="line">  --aShip    &#39;25,15,1500,3&#39; \</div>
<div class="line">  --aSpeckle &#39;-20,16,false&#39; \</div>
<div class="line">  --aGapFill &#39;1500,5,0.1&#39; \</div>
<div class="line">  --aRemover &#39;0.5,nodata,true&#39; \</div>
<div class="line">-o volume-corrected.h5    </div>
</div><!-- fragment --><p>By default, AnDRe commands apply to the full volume input. Each operator will look for quantities (typically DBZH) it needs as input. To decrease computation time, the processing can be limited using <code>&ndash;select</code> command, for example: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume-anomalous.h5 --select <span class="stringliteral">&#39;dataset1:5/data1:3&#39;</span> &lt;andre-cmds&gt; ...</div>
</div><!-- fragment --><p> For details, see <a class="el" href="index.html#selecting">Selecting data</a> .</p>
<p>The design of <b>AnDRe</b> detectors is based on <b>Ropo</b> , the operational anomaly detection C program applied in FMI since 2001. <br  />
 Each detector has been fully rewritten as a respective C++ class (<a class="el" href="classrack_1_1BiometOp.html" title="Detects birds and insects.">rack::BiometOp</a>, <a class="el" href="classrack_1_1EmitterOp.html" title="A quick emitter detection based on subtracting horizontal window medians by vertical ones.">rack::EmitterOp</a>, <a class="el" href="classrack_1_1ShipOp.html" title="Detects ships.">rack::ShipOp</a>, <a class="el" href="classrack_1_1SpeckleOp.html">rack::SpeckleOp</a>) which internally applies functions of the <b>Drain</b> library, for example segment size analysis, moving window filters and statistics. In development, emphasis has been on code re-usability, speed and stability; see implementation details further below.</p>
<p><b>Rack</b> provides several detectors that compute detection fields ie. probablity images, explained next. The removal procedures are explained after that.</p>
<h1><a class="anchor" id="detectors"></a>
Detection</h1>
<p>Currently, <b>AnDRe</b> supports detection the following anomalies:</p>
<ol type="1">
<li>birds and insects ("biometeors")</li>
<li>emitter lines</li>
<li>widespread electromagnetic interference (jamming)</li>
<li>ships</li>
<li>speckle noise</li>
</ol>
<p><a class="el" href="quickpage.html#commands_andre">Anomaly detection and removal</a> start with <code>'&ndash;a'</code>, and can be listed with </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> --help andre </div>
</div><!-- fragment --><h2><a class="anchor" id="aBiomet"></a>
Detecting birds and insects (single-pol)</h2>
<p>\copydesc <a class="el" href="classrack_1_1BiometOp.html" title="Detects birds and insects.">rack::BiometOp</a></p>
<div class="fragment"><div class="line">rack volume.h5 --aBiomet &#39;-10,500,5,1000&#39; -o aBiomet.h5</div>
<div class="line">  % reflMax=-10 [dBZ]</div>
<div class="line">  % maxAltitude=500 [m]</div>
<div class="line">  % reflDev=5 [dBZ]</div>
<div class="line">  % devAltitude=1000 [m]</div>
</div><!-- fragment --><div class="image">
<img src="result-biomet.png" alt=""/>
<div class="caption">
Detection results of <code>--aBiomet</code> .</div></div>
 <h2><a class="anchor" id="aBiomet2"></a>
Detecting birds and insects (dual-pol)</h2>
<p>There is also detectors for birds and insects using dual-pol data.</p>
<div class="fragment"><div class="line">rack volume.h5 --aBird &#39;0,0:3,0.72:0.8,1,2500,5&#39; -o aBird.h5</div>
<div class="line">  % dbzPeak=0 [Typical reflectivity (DBZH)]</div>
<div class="line">  % vradDevMin=0:3 [Fuzzy threshold of Doppler speed (VRAD) deviation (m/s)]</div>
<div class="line">  % rhoHVmax=0.72:0.8 [Fuzzy threshold of maximum rhoHV value]</div>
<div class="line">  % zdrAbsMin=1 [Fuzzy threshold of absolute ZDR]</div>
<div class="line">  % windowWidth=2500 [window width, beam-directional (m)]</div>
<div class="line">  % windowHeight=5 [window width, azimuthal (deg)]</div>
</div><!-- fragment --><div class="image">
<img src="result-bird.png" alt=""/>
<div class="caption">
Detection results of <code>--aBird</code> .</div></div>
 <div class="fragment"><div class="line">rack volume.h5 --aInsect &#39;-10,0:5,0.63:0.7,3,2500,5&#39; -o aInsect.h5</div>
<div class="line">  % dbzPeak=-10 [Typical reflectivity (DBZH)]</div>
<div class="line">  % vradDevMax=0:5 [Fuzzy threshold of Doppler speed (VRAD) deviation (m/s)]</div>
<div class="line">  % rhoHVmax=0.63:0.7 [Fuzzy threshold of maximum rhoHV value]</div>
<div class="line">  % zdrAbsMin=3 [Fuzzy threshold of absolute ZDR]</div>
<div class="line">  % windowWidth=2500 [window width, beam-directional (m)]</div>
<div class="line">  % windowHeight=5 [window width, azimuthal (deg)]</div>
</div><!-- fragment --><div class="image">
<img src="result-insect.png" alt=""/>
<div class="caption">
Detection results of <code>--aInsect</code> .</div></div>
 <h2><a class="anchor" id="aClutter"></a>
Detecting ground clutter</h2>
<p>Based on pre-computed clutter map, scales the clutter probability for desired sweeps. The scaling is a heuristic. The loaded map should contain quantity <code>CLUTTER</code> which in each bin represents the probability of contamination. Notice that the quantity does not describe the intensity of contamination, yet might be computed from accumulated dBZ values as described in cluttermaps .</p>
<ul>
<li>alpha <img class="formulaInl" alt="$ \alpha = \angle(b,c)$" src="form_3.png"/>: "sky angle",</li>
</ul>
<div class="fragment"><div class="line">rack volume.h5 --aClutter &#39;0.5,1,CLUTTER,cluttermaps/cluttermap-${NOD}-${quantity}.h5&#39; -o aClutter.h5</div>
<div class="line">  % decay=0.5 [per 1000m]</div>
<div class="line">  % gamma=1 [brightness]</div>
<div class="line">  % quantity=CLUTTER [CLUTTER|OBSTACLE|...]</div>
<div class="line">  % file=cluttermaps/cluttermap-${NOD}-${quantity}.h5 [path syntax]</div>
</div><!-- fragment --><div class="image">
<img src="result-clutter.png" alt=""/>
<div class="caption">
Detection results of <code>--aClutterMap</code> .</div></div>
 <h2><a class="anchor" id="aDopplerNoise"></a>
Detecting variations in Doppler wind</h2>
<p>Faster yet less accurate bird detection is available as <code>aDopplerNoise</code> which computes standard deviation much in the same way the corresponding meteorological motion product <a class="el" href="motionpage.html#dopplerDev">Doppler wind variation</a> . It takes three parameters: speed <code>threshold</code> (m/s) as well as window width and height. The obtained deviation is converted to a detection probability by means of a fuzzy bell function.</p>
<div class="fragment"><div class="line">rack volume.h5 --aDopplerNoise &#39;3,1500,3&#39; -o aDopplerNoise.h5</div>
<div class="line">  % speedDevThreshold=3 [Minimum of bin-to-bin Doppler speed (VRAD) deviation (m/s)]</div>
<div class="line">  % windowWidth=1500 [window width, beam-directional (m)]</div>
<div class="line">  % windowHeight=3 [window height, azimuthal (deg)]</div>
</div><!-- fragment --><div class="image">
<img src="result-dopplerNoise.png" alt=""/>
<div class="caption">
Detection results of <code>--aDopplerNoise</code> .</div></div>
 <h2><a class="anchor" id="aEmitter"></a>
Detecting emitters (electromagnetic interference)</h2>
<p>AnDRe emitter detector takes four parameters: <code>lengthMin</code> (along the beam, kilometres), <code>widthMax</code> (azimuthal degrees) and <code>sensitivity</code> (between 0.0 and 1.0). The current implementation applies median filtering twice on the data: horizontally and vertically. Then, the vertical result is subtracted from the horizontal, revealing the horizontally elongated line segments. The computed medians are biased; instead of the conventional median position (at 0.5 of the cumulative distribution) one may lighten or darken the results with the sensitivity value. A high value darkens the vertical result and lightens the horizontal result, causing more line segments in the resulting detection field.</p>
<div class="fragment"><div class="line">rack volume.h5 --aEmitter &#39;5,5,0.5&#39; -o aEmitter.h5</div>
<div class="line">  % lengthMin=5 [km]</div>
<div class="line">  % thicknessMax=5 [deg]</div>
<div class="line">  % sensitivity=0.5 [0...1]</div>
</div><!-- fragment --><div class="image">
<img src="result-emitter.png" alt=""/>
<div class="caption">
Detection results of <code>--aEmitter</code> .</div></div>
 <h2><a class="anchor" id="aJamming"></a>
Detecting jamming</h2>
<p>In presense of intensive nearby transmitters or receiver malfunction radar data can be contaminated by intensive overall noise. <b>Rack</b> models the shape of such intensity as a function of distance and applies curve fitting to distinguish between smoothly matching noise areas and pronounced meteorological targets.</p>
<div class="fragment"><div class="line">rack volume.h5 --aJamming &#39;5,80,10,-1&#39; -o aJamming.h5</div>
<div class="line">  % smoothnessThreshold=5 [dBZ]</div>
<div class="line">  % distanceMin=80 [km]</div>
<div class="line">  % weightLower=10 [[0.0...1.0]]</div>
<div class="line">  % debugRow=-1 [index]</div>
</div><!-- fragment --><div class="image">
<img src="result-jamming1.png" alt=""/>
<div class="caption">
Detection results of <code>--aJamming</code> .</div></div>
 <div class="image">
<img src="result-jamming2.png" alt=""/>
<div class="caption">
Detection results of <code>--aJamming</code> .</div></div>
 <h2><a class="anchor" id="aNonMet"></a>
Detecting sea clutter and other non-meteorogical targets</h2>
<p>With the polarimetric quantity <em>RhoHV</em> one can easily detect some non-meteorological echoes such as sea clutter. For meteorological targets, <em>RhoHV</em> is close to 1.0 and below otherwise. For example, sea clutter can be detected with the following command:</p>
<div class="fragment"><div class="line">rack volume.h5 --aNonMet &#39;0.2:0.6,0,0,0.95&#39; -o aNonMet.h5</div>
<div class="line">  % threshold=0.2:0.6 [0...1[:0...1]]</div>
<div class="line">  % windowWidth=0 [metres]</div>
<div class="line">  % windowHeight=0 [degrees]</div>
<div class="line">  % medianPos=0.95 [0...1]</div>
</div><!-- fragment --><div class="image">
<img src="result-nonMet.png" alt=""/>
<div class="caption">
Detection results of <code>--aNonMet</code> .</div></div>
 <h2><a class="anchor" id="aShip"></a>
Detecting ships</h2>
<p>The ship detector takes four parameters: <code>minDBZ</code> (minimum reflectance), <code>devDBZ</code> (minimum reflectance difference in a neighborhood), <code>windowWidth</code> (neighbourhood's beam-directional width, metres), <code>windowHeight</code> (neighbourhood's azimuthal width, degrees). First, the detector function computes two separate fields: a fuzzy remapping of <code>minDBZ</code> and field resulting from high-pass filtering with given neighbourhood. Basically, the result is a fuzzy multiplication of those. <br  />
 In addition, artificial vertical "ship sidelobes" are computed for the latter field, modelling the radar echoes of highly reflective point targets. If the sidelobes also appear in the fuzzy intensity field, they become included in the final result.</p>
<div class="fragment"><div class="line">rack volume.h5 --aShip &#39;25,15,1500,3&#39; -o aShip.h5</div>
<div class="line">  % reflMin=25 [dBZ]</div>
<div class="line">  % reflDev=15 [dBZ]</div>
<div class="line">  % windowWidth=1500 [m]</div>
<div class="line">  % windowHeight=3 [deg]</div>
</div><!-- fragment --><div class="image">
<img src="result-ship.png" alt=""/>
<div class="caption">
Detection results of <code>--aShip</code> .</div></div>
 <h2><a class="anchor" id="aSpeckle"></a>
Detecting speckle noise</h2>
<p>Speckle detection needs two parameters: <code>threshold</code> (in dBZ) and <code>area</code> (fuzzy maximal speck size). This detector focuses on distinct, small specks, giving maximum value to single-pixel segments, and progressively smaller values for larger segments. The speckle detector applies a semi-recursive flood-fill type function in computing segment sizes: the image is traversed and each segment having intensity of at least <code>threshold</code> becomes analyzed. The size of each segment fuzzily converted to an intensity of equally shaped segment in the result image.</p>
<div class="fragment"><div class="line">rack volume.h5 --aSpeckle &#39;-20,16,false&#39; -o aSpeckle.h5</div>
<div class="line">  % threshold=-20 [dBZ]</div>
<div class="line">  % area=16 [bins]</div>
<div class="line">  % invertPolar=false [bins]</div>
</div><!-- fragment --><div class="image">
<img src="result-speckle3.png" alt=""/>
<div class="caption">
Detection results of <code>--aSpeckle</code> .</div></div>
 <p>The speck areas are optionally scaled to Cartesian coordinate system. Unscaled areas are better for detecting for non-physical, range independent anomalies like noise whereas scaled mode should be used if physical targets are focused. <br  />
</p>
<div class="image">
<img src="result-speckle.png" alt=""/>
<div class="caption">
Detection results of <code>--aSpeckle</code> without and with polar coordinate inversion.</div></div>
 <h2><a class="anchor" id="aSun"></a>
Detecting the Sun</h2>
<p>This detector calculates the position of the Sun and marks its with sector of given width and intensity. The detector does not analyse the data itself; sectors will be marked also inside precipitation.</p>
<div class="fragment"><div class="line">rack volume.h5 --aSun &#39;1,0.95&#39; -o aSun.h5</div>
<div class="line">  % beamWidth=1 [deg]</div>
<div class="line">  % sensitivity=0.95 [0...1]</div>
</div><!-- fragment --><div class="image">
<img src="result-sun.png" alt=""/>
<div class="caption">
Detection results of <code>--aSun</code> .</div></div>
 <h1><a class="anchor" id="andreCumulation"></a>
Cumulating quality fields</h1>
<p>Typically, user wants to detect several different types of anomalies. In the ODIM structure, <b>Rack</b> creates new data arrays for storing detection results:</p><ol type="1">
<li>An overall result (maximum) of all the detection operators executed, stored in <code>/dataset</code>??/data??/quality1, with <code>what:quantity=QIND</code> </li>
<li>If <code>&ndash;store</code> intermediate=1 has been called, all the intermediate detection results <br  />
 in <code>/dataset</code>??/data??/quality{N} where <code>{N}</code> is an index starting from 2, with <code>what:quantity=PROB-xxx</code> (non-standard)</li>
</ol>
<p><b>Universality</b>. Some detectors like <code>&ndash;aSpeckle</code> are <em>universal</em> , they apply not only for the quantity they have been computed on (like <code>DBZH</code>) but also other quantities (like <code>VRAD</code>). The resulting quality information is stored respectively to dataset level or data level. This policy can be toggled with <code>&ndash;aUniversal</code> .</p>
<p>The resulting cumulative field with <code>what:quantity=QIND</code> is inverted, reflecting the probability of <em>meteorological</em> echoes, ie. quality of the data. In parallel, the classification field with <code>what:quantity=CLASS</code> is updated. The fields are updated automatically after every detection command. They reside on the dataset level or data level, depending on detector universality described above.</p>
<p>In the removal stage, <b>AnDRe</b> combines the <code>QIND</code> and <code>CLASS</code> fields automatically. One may also combine the fields with <code>&ndash;aCombine</code> .</p>
<div class="image">
<img src="andre-detected-hdfview.png" alt=""/>
<div class="caption">
Cumulative field (top window) and distinct detection results (underlying windows).</div></div>
 <h1><a class="anchor" id="andreremoval"></a>
Anomaly removal</h1>
<p>After applying preferred detectors, original data in the volume can be enhanced with the help of the overall quality field, <code>/dataset1/quality/data</code> .</p>
<p>There are three techniques available for the removal:</p><ol type="1">
<li>erasing: replacing values with <code>nodata</code> </li>
<li>damping: turning values down</li>
<li>gap filling: replacing values with surrounding values having better quality</li>
</ol>
<p>The <code>&ndash;aRemover</code> command simply replaces data values with <code>nodata</code> in locations where the quality (anomaly probability) is lower than a threshold: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume-anomalous.h5  &lt;...detection commands...&gt; --aRemover 0.5  -o andre-removed.h5</div>
</div><!-- fragment --><p> By default, <code>aRemover</code> applies to practically all quantities (DBZH,TH,VRAD,RHOHV,...). This behaviour can be changed with <code>&ndash;select</code> command. <br  />
</p>
<div class="image">
<img src="volume-anom-sea-remover-panel.png" alt=""/>
<div class="caption">
A sweep corrected by <code>--aRemover</code> with threshold 0.25 (left) and 0.75 (right).</div></div>
 <p>A smooth erasure function is implemented as <code>&ndash;aDamper</code> which decreases intensity proportionally to the quality index. It applies to reflectivity data (DBZH) only. The lower the quality index, the more intensity will be decreased. An example of the erasing approach: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume-anomalous.h5  &lt;...detection commands...&gt; --aDamper 0.5 -o andre-damped.h5</div>
</div><!-- fragment --><p>The parameter defines the threshold quality. The bin values below the quality threshold will be smoothly erased.</p>
<div class="image">
<img src="volume-anom-sea-damper-panel.png" alt=""/>
<div class="caption">
A sweep corrected by <code>--aDamper</code> with threshold 0.25 (left) and 0.5 (right).</div></div>
 <p>Gap filling means replacing single values with neighboring, more reliable values. An example of the gap filling approach: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume-anomalous.h5  &lt;...detection commands...&gt;  --aGapFill 2000m,5deg  -o andre-gapfilled.h5</div>
</div><!-- fragment --><p>The parameters of <code>aGapFill</code> are window width and height as metres and azimuthal degrees, respectively. Internally, this operator is implemented using 8-directional <em>distance</em> <em>transform</em>.</p>
<div class="image">
<img src="volume-anom-sea-gapFill-panel.png" alt=""/>
<div class="caption">
A sweep corrected with gap fill parameters 1500m,3deg (left) and 2500m,7deg (right).</div></div>
 <p>Another, experimental gap filling operator <code>&ndash;aGapFillRec</code> is recursive and produces spline-like correction fields. The result is smoother but slower to compute. Internally, this operator is implemented by repeating a weighted averaging window. <br  />
</p>
<p>The removal command can be applied together, for example: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume-anomalous.h5  &lt;...detection commands...&gt;  --aDamper 0.5,0.1  --aGapFill 1500m,7deg  -o andre-corrected.h5</div>
</div><!-- fragment --><h1><a class="anchor" id="otherQuality"></a>
Other quality fields</h1>
<p>Detection based quality fields like the ones explained above describe the probability of signals originating from other than desired targets (other than precipitation, typically). In addition to those, <b>Rack</b> provides two operators that describe the quality.</p>
<h2><a class="anchor" id="aAttenuation"></a>
Attenuation in rain</h2>
<p>Radar signal attenuates in heavy rain. The amount of attenuation in liquid rain can be approximated from dBZ data using formula proposed by Ulrich Blahak: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ k(Z) = 1.12\cdot10^{-4} Z_e^{0.62} \]" src="form_0.png"/>
</p>
<div class="fragment"><div class="line">rack volume.h5 --aAttenuation &#39;3,1.12e-07,0.62,0,0&#39; -o aAttenuation.h5</div>
<div class="line">  % reflHalfWidth=3 [dBZ limit of 50% quality]</div>
<div class="line">  % c=1.12e-07 [coeff]</div>
<div class="line">  % p=0.62 [coeff]</div>
<div class="line">  % c2=0 [coeff]</div>
<div class="line">  % p2=0 [coeff]</div>
</div><!-- fragment --><div class="image">
<img src="result-attenuation1.png" alt=""/>
<div class="caption">
Detection results of <code>--aAttenuation</code> .</div></div>
 <div class="image">
<img src="result-attenuation2.png" alt=""/>
<div class="caption">
Detection results of <code>--aAttenuation</code> .</div></div>
 <p>Note that this field should NOT be used for removing echoes; the radar has already cleaned data in signal processor. However, this operator should be computed after removal operators (if applied). The resulting (total) quality field can be used in further production, like quality based compositing in which input bins of lower quality will be overridden by other, overlapping bins of higher quality.</p>
<h2><a class="anchor" id="aCCor"></a>
Using Doppler filtering result</h2>
<p>If both the total reflectivity (<code>TH</code> ) and Doppler filtered reflectivity are available, their difference provides information where the radar has detected static i.e. suspicious targets. The <code>CCor</code> operator computes the diffence between these and fuzzifies the result such that at the given threshold reflecitivy difference the probability of anomaly is 0.5.</p>
<div class="fragment"><div class="line">rack volume.h5 --aCCor &#39;10:30&#39; -o aCCor.h5</div>
<div class="line">  % threshold=10:30 [dBZ range]</div>
</div><!-- fragment --><div class="image">
<img src="result-cCor.png" alt=""/>
<div class="caption">
Detection results of <code>--aCCor</code> .</div></div>
 <p>Note that this field should NOT be used for removing echoes; the radar has already cleaned data in signal processor. However, this operator should be computed after removal operators (if applied). The resulting (total) quality field can be used in further production, like quality based compositing in which input bins of lower quality will be overridden by other, overlapping bins of higher quality.</p>
<h2><a class="anchor" id="aTime"></a>
Timing based quality</h2>
<p>Likewise, we can associate timing based quality field that describes the extent in which each measurement bin is representative of the nomimal time of the volume or some other desired time, like the nominal time of a composite.</p>
<div class="fragment"><div class="line">rack volume.h5 --aTime &#39;NOMINAL,1,-1&#39; -o aTime.h5</div>
<div class="line">  % time=NOMINAL [NOMINAL,NOW,&lt;YYYYmmddMMHH&gt;]</div>
<div class="line">  % decayPast=1 [mins]</div>
<div class="line">  % decayFuture=-1 [mins]</div>
</div><!-- fragment --><div class="image">
<img src="result-time.png" alt=""/>
<div class="caption">
'Detection' results of <code>--aTime</code> .</div></div>
  </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="anamespacerack_html"><div class="ttname"><a href="namespacerack.html">rack</a></div><div class="ttdef"><b>Definition:</b> AndreOp.cpp:46</div></div>
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
