<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rack: Text output</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="rack.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rack-logo-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><!-- rack /-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Text output </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#text-output">Extracting metadata</a><ul><li class="level2"><a href="#dumps">Simple dump of metadata</a></li>
<li class="level2"><a href="#templates">Formatting metadata output using templates</a></li>
</ul>
</li>
<li class="level1"><a href="#sampling">Sampling data</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="text-output"></a>
Extracting metadata</h1>
<h2><a class="anchor" id="dumps"></a>
Simple dump of metadata</h2>
<p>The basic way to view context in textual format is to write a file with <code>'</code>.txt' extension:</p>
<p>Using <code>&ndash;outputFile</code> , the <em>structure</em> of the current data can be written as plain text in a file (*.txt) or to standard input (-): </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 -o volume.txt</div>
<div class="ttc" id="anamespacerack_html"><div class="ttname"><a href="namespacerack.html">rack</a></div><div class="ttdef"><b>Definition:</b> DataSelector.cpp:44</div></div>
</div><!-- fragment --><p>File <code>volume.txt</code> will consist of lines of ODIM entries as follows: </p><div class="fragment"><div class="line">dataset1</div>
<div class="line">dataset1/data1</div>
<div class="line">dataset1/data1/data</div>
<div class="line">dataset1/data1/data:image=[500,360]</div>
<div class="line">dataset1/data1/what</div>
<div class="line">...</div>
<div class="line">    ...</div>
<div class="line">        ...</div>
<div class="line">how:simulated=&quot;False&quot;</div>
<div class="line">how:software=&quot;IRIS&quot;</div>
<div class="line">how:sw_version=&quot;8.13&quot;</div>
<div class="line">how:system=&quot;VAISWRM200&quot;</div>
<div class="line">how:wavelength=5.33</div>
</div><!-- fragment --><h2><a class="anchor" id="templates"></a>
Formatting metadata output using templates</h2>
<p>There is often need to produce metadata text for:</p><ul>
<li>Text files completing data formats not supporting metadata</li>
<li>Log entries</li>
<li>HTML files applied in monitoring product generation</li>
<li>Graphical layouts (eg. SVG)</li>
<li>Geographic definition files (eg. KML) for adding radar products to GIS applications</li>
</ul>
<p>One can easily export metadata of current HDF5 structure (latest volume read or product generated). The output is a text file in which variables <code>${variable}</code> have been expanded to their current values.</p>
<p>The text template can be defined briefly on command line by <code>&ndash;format</code> or by reading a file with <code>&ndash;formatFile</code> .</p>
<p>For example, from a Cartesian product one may extract the projection and a bounding box with the following command: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 -c  --format <span class="stringliteral">&#39;BBOX=${where:LL_lon},${where:LL_lat},${where:UR_lon},${where:UR_lat}\n&#39;</span> -o formatOut.txt </div>
</div><!-- fragment --><p>The result: </p><div class="fragment"><div class="line">BBOX=21.4734,62.4469,32.0369,66.9151</div>
</div><!-- fragment --><p>The applicable variables are those the ODIM variables (what:product, where:lat, ...). In addition, <code>what:source</code> fields (<code>NOD</code>, <code>WMO</code> , <code>RAD</code> , <code>PLC</code> , <code>CMT</code> ) are searched for and expanded to convenience variables (<code>${NOD}</code>, etc...). The list of current variables can be examined with <code>&ndash;status</code> command.</p>
<p>For example, assume template file <code>radar-conf.tpl</code> with the following contents:</p>
<div class="fragment"><div class="line"># Metadata for radar &#39;${NOD}&#39;</div>
<div class="line"> </div>
<div class="line">SOURCE=&quot;${what:source}&quot;</div>
<div class="line">NOD=&quot;${NOD}&quot;</div>
<div class="line">WMO=&quot;${WMO}&quot;</div>
<div class="line">PLC=&quot;${PLC}&quot;</div>
<div class="line">LAT=&quot;${where:lat}&quot;</div>
<div class="line">LON=&quot;${where:lon}&quot;</div>
<div class="line">HEIGHT=&quot;${where:height}&quot;</div>
<div class="line">PROJDEF=&quot;${where:projdef}&quot;</div>
<div class="line">BBOX=&quot;${where:LL_lon},${where:LL_lat},${where:UR_lon},${where:UR_lat}&quot;</div>
</div><!-- fragment --><p>Then, </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 -c --formatFile radar-conf.tpl --formatOut out.cnf  </div>
</div><!-- fragment --><p> produces code which can be used by applications supporting <b>Proj4</b> projection syntax. The result:</p>
<div class="fragment"><div class="line"># Metadata for radar &#39;fiuta&#39;</div>
<div class="line"> </div>
<div class="line">SOURCE=&quot;WMO:02870,RAD:FI47,PLC:Utajärvi,NOD:fiuta&quot;</div>
<div class="line">NOD=&quot;fiuta&quot;</div>
<div class="line">WMO=&quot;02870&quot;</div>
<div class="line">PLC=&quot;Utajärvi&quot;</div>
<div class="line">LAT=&quot;64.7749&quot;</div>
<div class="line">LON=&quot;26.3189&quot;</div>
<div class="line">HEIGHT=&quot;118&quot;</div>
<div class="line">PROJDEF=&quot;+proj=aeqd +lon_0=26.3189 +lat_0=64.7749 +ellps=WGS84&quot;</div>
<div class="line">BBOX=&quot;21.4734,62.4469,32.0369,66.9151&quot;</div>
</div><!-- fragment --><p>Further, using <code>&ndash;script</code> one can quickly create similar conf files with a single command: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> --formatFile radar-conf.tpl --script <span class="stringliteral">&#39;--cReset -c --formatOut site-${NOD}.cnf&#39;</span> &lt;volumes.h5&gt;</div>
</div><!-- fragment --><p><b>New</b>. Latest versions of <b>Rack</b> support variable formatting with following options</p>
<ol type="1">
<li><code>bash</code> style substring extraction: <code></code>:startpos or <code></code>:startpos:length (as with <code>bash</code> shell variables)</li>
<li>C <code>printf()</code> styled value formatting, like <code>%4.2f</code> or <code>%8d</code> (see <a href="https://cplusplus.com/reference/cstdio/printf/">https://cplusplus.com/reference/cstdio/printf/</a> )</li>
<li><code>date</code> style date and time formatting, like <code>Y/m/d</code> or <code>H</code>:M – for variables with names ending with "date" or "time".</li>
</ol>
<p>This options are illustrated with examples: </p><div class="fragment"><div class="line"><span class="preprocessor"># </span></div>
<div class="line"><span class="preprocessor">rack volume.h5  --format &#39;time: ${what:startdate|%Y-%m-%d} ${what:starttime|%H:%M} elangle: ${where:elangle|%04.1f} \n&#39;  --select dataset:/ -o elangles.out</span></div>
</div><!-- fragment --> <div class="fragment"><div class="line">time: 2014-08-27 09:00 elangle: 00.3 </div>
<div class="line">time: 2014-08-27 09:00 elangle: 00.7 </div>
<div class="line">time: 2014-08-27 09:00 elangle: 01.5 </div>
<div class="line">time: 2014-08-27 09:01 elangle: 03.0 </div>
<div class="line">time: 2014-08-27 09:01 elangle: 05.0 </div>
<div class="line">time: 2014-08-27 09:01 elangle: 09.0 </div>
<div class="line">time: 2014-08-27 09:02 elangle: 02.0 </div>
<div class="line">time: 2014-08-27 09:02 elangle: 07.0 </div>
<div class="line">time: 2014-08-27 09:02 elangle: 11.0 </div>
<div class="line">time: 2014-08-27 09:03 elangle: 15.0 </div>
<div class="line">time: 2014-08-27 09:03 elangle: 25.0 </div>
<div class="line">time: 2014-08-27 09:03 elangle: 45.0 </div>
<div class="line">time: 2014-08-27 09:04 elangle: 00.4 </div>
</div><!-- fragment --><h1><a class="anchor" id="sampling"></a>
Sampling data</h1>
<p>The input volume as well as the generated polar or Cartesian products can be sampled, producing a text file. The sampling is performed automatically if output file has the extension '.dat'. For example: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 -o samples.dat</div>
</div><!-- fragment --><p>The result: </p><div class="fragment"><div class="line">## input properties </div>
<div class="line"># bbox=[1507.9672560563260504,3892.9862409188299353,1507.9629643527550797,3892.9862409202742128]</div>
<div class="line"># height=360</div>
<div class="line"># lat=64.77493012323975563</div>
<div class="line"># lon=26.318880077451467514</div>
<div class="line"># width=500</div>
<div class="line">## sampling parameters </div>
<div class="line"># commentChar=&quot;#&quot;</div>
<div class="line"># handleVoid=&quot;null&quot;</div>
<div class="line"># i=[-1,1]</div>
<div class="line"># iStep=10</div>
<div class="line"># j=[-1,1]</div>
<div class="line"># jStep=0</div>
<div class="line"># skipVoid=false</div>
<div class="line"># format=&#39;${i},${j},${LON},${LAT},${X},${Y},${RANGE},${AZM},${HGHT}&#39;</div>
<div class="line">## resulting geometry </div>
<div class="line"># rows=50</div>
<div class="line"># rols=36</div>
<div class="line"># samples=1800</div>
<div class="line">5,5,1508.25,3712.74,239.678,2739.54,2750,5,14.844 #void</div>
<div class="line">25,5,1509.31,3717.86,1111.24,12701.5,12750,5,76.3267</div>
<div class="line">65,5,1511.44,3728.09,2854.35,32625.4,32750,5,234.606</div>
<div class="line">75,5,1511.97,3730.65,3290.13,37606.3,37750,5,281.533</div>
<div class="line">85,5,1512.51,3733.21,3725.91,42587.3,42750,5,331.402</div>
<div class="line">95,5,1513.05,3735.77,4161.69,47568.3,47750,5,384.214</div>
<div class="line">...</div>
<div class="line">    ...</div>
<div class="line">        ...</div>
<div class="line">455,355,1482.1,3827.87,-19849.7,226883,227750,355,4244.53</div>
<div class="line">465,355,1481.48,3830.43,-20285.5,231864,232750,355,4406.15</div>
<div class="line">475,355,1480.86,3832.99,-20721.3,236845,237750,355,4570.71</div>
<div class="line">485,355,1480.24,3835.55,-21157.1,241826,242750,355,4738.21</div>
<div class="line">495,355,1479.62,3838.1,-21592.8,246807,247750,355,4908.65</div>
</div><!-- fragment --><p>The default sampling step is 10 in both horizontal and vertical direction, and all the quantities are sampled. One may apply <code>&ndash;select</code> command to get desired subset of quantities. Further, <code>&ndash;format</code> modifies output layout; variables inserted like <code>${NAME}</code> are converted to actual values in output. (See <code>format</code> in the file header above).</p><ul>
<li><em>i</em> and <em>j</em> : image coordinates, from top-left corner (bin and azimuth index in polar sampling);</li>
<li><em>j2:</em> inverted vertical image coordinate ie. from bottom-left corner (in Cartesian sampling only)</li>
<li><em>LON</em> and <em>LAT</em> : geographical coordinates, in degreees</li>
<li><em>X</em> and <em>Y</em> : map coordinates, in metres</li>
<li><em>AZM</em> and <em>RANGE:</em> polar coordinates (in polar sampling only)</li>
<li>the quantities, eg. <code>DBZH</code> , <code>VRAD</code> , and so on, including quality quantities like <code>QIND</code>. The default format consists of all the applicable coordinates and quantities separated by space. Values can be negated by putting a minus sign inside the curly braces of a format string. <br  />
</li>
</ul>
<p>Sampling steps, start, and end can be changed with <code>&ndash;sample</code> command. One may also skip lines containing <code>undetect</code> or <code>nodata</code> samples. If a comment char is defined some metadata, including applied format, appears as comments in the start of the output.</p>
<div class="fragment"><div class="line">--sample  &lt;iStep&gt;,&lt;jStep&gt;,&lt;i&gt;,&lt;j&gt;,&lt;commentChar&gt;,&lt;skipVoid&gt;,&lt;handleVoid&gt;  (section: general)</div>
<div class="line">  Extract samples. See --format.</div>
<div class="line">    iStep=10 [horz coord step]</div>
<div class="line">    jStep=0 [vert coord step]</div>
<div class="line">    i=-1:1 [horz index or range]</div>
<div class="line">    j=-1:1 [vert index or range]</div>
<div class="line">    commentChar=# [comment prefix (char or bytevalue)]</div>
<div class="line">    skipVoid=false [skip lines with invalid/missing values]</div>
<div class="line">    handleVoid=null [skip or mark invalid values [skip|null|&lt;number&gt;]]</div>
</div><!-- fragment --><p>Example of a formatted sampling: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 --select quantity=DBZH --sample 10,30,i=50:200,j=0:50 --format <span class="stringliteral">&#39;${i},${j} (${LON},${LAT}) ${DBZH}&#39;</span> -o samples-formatted.dat</div>
</div><!-- fragment --><p>The result: </p><div class="fragment"><div class="line">## input properties </div>
<div class="line"># bbox=[1507.9672560563260504,3892.9862409188299353,1507.9629643527550797,3892.9862409202742128]</div>
<div class="line"># height=360</div>
<div class="line"># lat=64.77493012323975563</div>
<div class="line"># lon=26.318880077451467514</div>
<div class="line"># width=500</div>
<div class="line">## sampling parameters </div>
<div class="line"># commentChar=&quot;#&quot;</div>
<div class="line"># handleVoid=&quot;null&quot;</div>
<div class="line"># i=[50,200]</div>
<div class="line"># iStep=10</div>
<div class="line"># j=[0,50]</div>
<div class="line"># jStep=30</div>
<div class="line"># skipVoid=false</div>
<div class="line"># format=&#39;${i},${j} (${LON},${LAT}) ${DBZH}&#39;</div>
<div class="line">## resulting geometry </div>
<div class="line"># rows=50</div>
<div class="line"># rols=12</div>
<div class="line"># samples=600</div>
<div class="line">50,0 (1507.96,3724.3) -13.99</div>
<div class="line">90,0 (1507.96,3734.58) -10.79</div>
<div class="line">60,30 (1526.34,3724.77) -11.71</div>
<div class="line">70,30 (1529.41,3726.99) -5.82</div>
<div class="line">80,30 (1532.48,3729.21) -10.65</div>
<div class="line">...</div>
<div class="line">    ...</div>
<div class="line">        ...</div>
<div class="line">160,30 (1557.43,3746.9) null #void</div>
<div class="line">170,30 (1560.59,3749.11) null #void</div>
<div class="line">180,30 (1563.76,3751.31) 6.74</div>
<div class="line">190,30 (1566.93,3753.52) 19.96</div>
<div class="line">200,30 (1570.12,3755.72) null #void</div>
</div><!-- fragment --><p>Likewise, one can sample Cartesian data. Example: </p><div class="fragment"><div class="line"><a class="code" href="namespacerack.html">rack</a> volume.h5 --select quantity=DBZH --cSize 500,500 -c --sample 50,50  -o samples-cart.dat</div>
</div><!-- fragment --><p>The result: </p><div class="fragment"><div class="line">## input properties </div>
<div class="line"># bbox=[21.473369970467263812,62.446873711034854182,32.036889576527528334,66.915064520295331363]</div>
<div class="line"># epsg=0</div>
<div class="line"># height=500</div>
<div class="line"># proj=&quot;+proj=aeqd +lon_0=26.3189 +lat_0=64.7749 +ellps=WGS84&quot;</div>
<div class="line"># width=500</div>
<div class="line">## sampling parameters </div>
<div class="line"># commentChar=&quot;#&quot;</div>
<div class="line"># handleVoid=&quot;null&quot;</div>
<div class="line"># i=[-1,1]</div>
<div class="line"># iStep=50</div>
<div class="line"># j=[-1,1]</div>
<div class="line"># jStep=50</div>
<div class="line"># skipVoid=false</div>
<div class="line"># format=&#39;${i},${j},${LON},${LAT},${X},${Y},${j2}&#39;</div>
<div class="line">## resulting geometry </div>
<div class="line"># rows=10</div>
<div class="line"># rols=10</div>
<div class="line"># samples=100</div>
<div class="line">25,25,21.2287,66.7069,-224500,224500,474 #void</div>
<div class="line">225,25,25.7622,66.7873,-24500,224500,474</div>
<div class="line">275,25,26.8983,66.7872,25500,224500,474</div>
<div class="line">225,75,25.7721,66.339,-24500,174500,424</div>
<div class="line">175,125,24.6855,65.8829,-74500,124500,374</div>
<div class="line">225,125,25.7816,65.8906,-24500,124500,374</div>
<div class="line">...</div>
<div class="line">    ...</div>
<div class="line">        ...</div>
<div class="line">275,475,26.8178,62.7511,25500,-225500,24 #void</div>
<div class="line">325,475,27.7958,62.7441,75500,-225500,24 #void</div>
<div class="line">375,475,28.773,62.7303,125500,-225500,24 #void</div>
<div class="line">425,475,29.7492,62.7096,175500,-225500,24 #void</div>
<div class="line">475,475,30.7237,62.682,225500,-225500,24 #void</div>
</div><!-- fragment --><p>Note that <code>&ndash;cCreate</code> maps a single quantity to Cartesian coordinates; the quantity can be changed with <code>&ndash;select</code> .</p>
<p><a class="el" href="miscbook.html#checkscope">Does a radar overlap with a given geographical scope?</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.1
</small></address>
</body>
</html>
