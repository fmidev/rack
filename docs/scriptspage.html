<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rack: Scripts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="rack.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="rack-logo-110x55.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><!-- rack /-->
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Scripts</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#scripts">Defining scripts</a><ul><li class="level2"><a href="#script_sites">Example: product generation for each volume.</a></li>
</ul>
</li>
<li class="level1"><a href="#embedCommands">Inserting commands directly</a><ul><li class="level2"><a href="#embedCommandsTXT">Commands as text files</a></li>
<li class="level2"><a href="#embedCommandsJSON">Commands as JSON files</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="scripts"></a>
Defining scripts</h1>
<p>In operational radar product generation, a frequent need is to repeat a routine to several inputs, say tens or even hundreds of input volumes. <br  />
 <b>Rack</b> supports defining such routines as <em>scripts</em> that can be invoked repeatedly using a single command line. A script is command sequence that is then executed automatically for <em>each</em> <em>input:</em> </p>
<div class="fragment"><div class="line"><a class="code hl_namespace" href="namespacerack.html">rack</a> --script <span class="stringliteral">&#39;&lt;cnd&gt; &lt;cmd2&gt; ...&#39;</span>  &lt;file&gt; &lt;file2&gt; &lt;file3&gt; ...</div>
<div class="ttc" id="anamespacerack_html"><div class="ttname"><a href="namespacerack.html">rack</a></div><div class="ttdef"><b>Definition</b> DataSelector.cpp:44</div></div>
</div><!-- fragment --><p>So, <code>--inputFile</code> &lt;file&gt; command – or simply <code></code> &lt;file&gt; – implicitly triggers the script.</p>
<p>One can also invoke the script explicitly with <code>--execScript</code> command. Defining a script also turns on <em>variable</em> <em>expansion</em> &ndash; see also examples in <a class="el" href="text-output-page.html#templates">Formatting metadata output using templates</a> .</p>
<h2><a class="anchor" id="script_sites"></a>
Example: product generation for each volume.</h2>
<p>In the following example, several measurement volume files are read. For each file, two products (Pseudo CAPPI at 500 meters and Echo Top with 20 dBZ threshold) are computed, then converted to Cartesian projections and finally stored to files.</p>
<div class="fragment"><div class="line"><a class="code hl_namespace" href="namespacerack.html">rack</a> --script <span class="stringliteral">&#39;--pCappi 500 -c -o cappi-${NOD}.h5 --pEchoTop 20 -c -o echoTop-${NOD}.h5&#39;</span>  data/pvol_fi*.h5 </div>
</div><!-- fragment --><p>In the example, special internal variable <code>${NOD}</code> is derived automatically from compound <code>${what:source}</code> variable of the input. One may likewise use <code>${what:date}</code> and <code>${what:time}</code> , for example.</p>
<dl class="section note"><dt>Note</dt><dd><b>Rack</b> denotes variables <code>${</code>...} like shell environments, so single hyphens are often useful for preventing variable expansion in shell. Supported variable values can be listed with <code>--status</code> command.</dd></dl>
<p>By default, unless <code>--append</code> data was used, the resulting meteorological product is kept in the local context. This means that data from several radars can be processed and also stored as parallel processes.</p>
<p>Scripting becomes even more powerful when combined with <a class="el" href="parallelpage.html">Parallel computation</a> .</p>
<h1><a class="anchor" id="embedCommands"></a>
Inserting commands directly</h1>
<p>An alternative to predefined scripts is to read commands from a file and insert them directly, equivalently to inserting them among command line arguments.</p>
<h2><a class="anchor" id="embedCommandsTXT"></a>
Commands as text files</h2>
<p>An example illustrates this. Assume that file <code>cmdExample.txt</code> contains:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># intermediate result (data) of anomaly detection will be stored </span></div>
<div class="line">--store 2</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Run a detector (no data correction in this example)</span></div>
<div class="line">--aSpeckle <span class="stringliteral">&#39;-20,area=16&#39;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Prepare to store meteorological products in separate dataset&lt;n&gt;&#39;s</span></div>
<div class="line">--append dataset</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Compute a meteorological product</span></div>
<div class="line">--pEchoTop 10 </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Define a string format for debugging</span></div>
<div class="line">--format <span class="stringliteral">&quot;${what:quantity}\n${what:date}${what:time}\n&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Display that debug string in std output</span></div>
<div class="line">--outputFile <span class="stringliteral">&quot;-&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># Compute a meteorological product</span></div>
<div class="line">--pCappi <span class="stringliteral">&quot;500,aboveSeaLevel=true&quot;</span></div>
<div class="line"><span class="preprocessor"># --pCappi &quot;aboveSeaLevel=true,&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor"># reset string format (re-enables text file output to use default output)</span></div>
<div class="line">--format <span class="stringliteral">&quot;&quot;</span></div>
</div><!-- fragment --><p>Then, consider the following command line: </p><div class="fragment"><div class="line"><a class="code hl_namespace" href="namespacerack.html">rack</a> volume.h5  --execFile cmdExample.txt -o result.h5   </div>
</div><!-- fragment --><p> As a result, the program will run as if the command in the file had been inserted on command line.</p>
<h2><a class="anchor" id="embedCommandsJSON"></a>
Commands as JSON files</h2>
<p>The latest versions of <code>Rack</code> support also JSON files, which are useful in environments involving, say, graphical user interfaces – for example, a user may adjust a single product parameter at a time using dedicated widgets, and the system stores the values in a JSON structure. The above commands are equivalently defined in JSON as follows. </p><div class="fragment"><div class="line">{</div>
<div class="line">    &quot;store&quot;: 2,</div>
<div class="line">    &quot;aSpeckle&quot;: {</div>
<div class="line">        &quot;threshold&quot;: -20,</div>
<div class="line">        &quot;area&quot;: 16</div>
<div class="line">    },</div>
<div class="line">    &quot;append&quot;: &quot;dataset&quot;,</div>
<div class="line">    &quot;format&quot;: &quot;${what:quantity}\n${what:date}${what:time}\n&quot;,</div>
<div class="line">    &quot;pEchoTop&quot;: 10,</div>
<div class="line">    &quot;outputFile&quot;: &quot;-&quot;,</div>
<div class="line">    &quot;pCappi&quot;: &quot;500,aboveSeaLevel=true&quot;,</div>
<div class="line">    &quot;format&quot;: &quot;&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In the above JSON code, layout style varies on purpose; a group can be set on a single line or several lines, with indentation. For <b>Rack</b>, parameters can be set as a single element (string or number) or as a group, as illustrated. Note that commands that have no parameters must still have a value (empty string <code>""</code> or empty group <code>{}</code> ).</p>
<p>Hint: Remember that plain filenames are implicit <code>&ndash;inputFile &lt;file&gt;</code> commands; hence the file can also be a list of input files (in above line format only, so excluding JSON). Using such a file together with <code>--script</code> yields compact command lines especially in compositing. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.8
</small></address>
</body>
</html>
